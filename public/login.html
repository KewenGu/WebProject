<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Login or Sign Up</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  </head>
  <body>
    <div class="container">
      <div class="row" id="form">
        <div class="forms col-lg-4">
          <form>
            <h3 class="header-note"><b>Login</b></h3>
            <br>
            <label for="login-username">User Name: </label><input type="text" id="login-username" class="textfield" required>
            <br>
            <label for="login-password">Password: </label><input type="password" id="login-password" class="textfield" required>
            <br>
            <div id="login-notif"></div>
            <input type="submit" value="Login" class="button" onclick="login();">
          </form>
        </div>
        <div class="forms col-lg-4">
          <form>
            <h3 class="header-note"><b>Sign Up</b></h3>
            <br>
            <label for="signup-username">User Name: </label><input type="text" id="signup-username" class="textfield" required>
            <br>
            <label for="signup-password">Password: </label><input type="password" id="signup-password" class="textfield" required>
            <br>
            <label for="signup-email">Email: </label><input type="email" id="signup-email" class="textfield" required>
            <br>
            <div id="signup-notif"></div>
            <input type="submit" value="Sign Up" class="button" onclick="signup();">
          </form>
        </div>
      </div>
    </div>
  </body>
  <footer>
    <p>CS4241-Webware Final Project (Fall 2015)</p>
    <p>Worcester Polytechnic Institute</p>
  </footer>
  <script>

    function login() {
      var el1 = document.getElementById("login-username");
      var el2 = document.getElementById("login-password");

      var req = new XMLHttpRequest();
      req.open('POST', '/login', true);
      req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

      req.onload = function () {
        makeGet('/status', notif);
      };
      req.send('username=' + el1.value + '&password=' + el2.value);
    }

    function signup() {
      var el1 = document.getElementById("signup-username");
      var el2 = document.getElementById("signup-password");
      var el3 = document.getElementById("signup-email");

      var req = new XMLHttpRequest();
      req.open('POST', '/signup', true);
      req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

      req.onload = function () {
        makeGet('/status', notif);
      };
      req.send('username=' + el1.value + '&password=' + el2.value + '&email=' + el3.value);

    }



    makeGet('/login', "#login-notif");
    makeGet('/signup', "#signup-notif");


    function makeGet(url, id) {
      var req = new XMLHttpRequest();

      req.onreadystatechange = function() {
        handleRes(req, id);
      };

      req.open('GET', url);
      req.send();
    }

    function handleRes(req, id) {
      if( req.readyState !== XMLHttpRequest.DONE )
        return;

      if(req.status === 200) {
        console.log(id);
        console.log(req.responseText);
        if (id === "#login-notif" && req.responseText === "Done") {
          console.log("proceed into main page")
          window.location.assign("/main");
        }
        else if (id === "#signup-notif" && req.responseText === "Done") {
          document.querySelector(id).innerText = "Your account has been created!";
        }
        else {
          document.querySelector(id).innerText = req.responseText;
        }

      }
    }

    function validateEmail(email) {
      var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return re.test(email);
    }
  </script>
</html>
